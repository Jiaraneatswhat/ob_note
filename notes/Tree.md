# 1. B-Tree
- 2-3 树是一种特殊的 B-树，它满足：
	- 2-节点有 {0, 2} 个子节点
	- 3-节点有 {0, 3} 个子节点
	- 所有叶子节点都在同一层
## 1.1 B-树的性质
- B 树非叶子节点的结构

![[b_tree_node.svg]]
- $n$: key 的个数
- $p$：指针
- $k$：key
- $p_0$ 至 $p_n$ 从小到大排列用于划分区间
- $k$ 的个数比 $p$ 的个数少一个

- $m$ 阶 B -树的性质
	- 每个节点最多有 $m$ 个子节点，至多含有 $m-1$ 个`key`
	- 除根节点外，每个非叶子节点至少有 $ceil(\frac{m}{2})$ 个子节点
	- 根节点有 0 或者至少 2 个子节点
	- 叶子节点都在同一层
- B-树将文件以 <font color='red'>Page</font> 为单位进行存储，每个 Page 作为 B-树的一个节点

![[b_tree_page.svg]]

B-树每个节点都存放着索引和数据，搜索可能在非叶子节点结束，最好的情况是 $O(1)$
## 1.2 B-树的删除
### 1.2.1 要删除的键在叶子节点中
#### 1.2.1.1 不超过子结点 key 下限

![[b_tree_del1.svg]]

- 此时删除 31 没有影响(3 阶要求非叶子节点且非根节点有 $ceil(3/2)=2$ 个结点)，直接删除
#### 1.2.1.2 超过子结点 key 下限

![[b_tree_del2.svg]]

- 此时不能直接删除 32
- 对树结构做调整：从左至右向兄弟节点借用 `key`，借到 28
	- 28 上移，30 下移后删除 32

![[b_tree_del3.svg]]

#### 1.2.1.3 可以合并的情况

![[b_tree_del4.svg]]

- 要删除 30 时，左右兄弟节点都不能借节点时，需要进行合并
	- 28 下移与 25 合并后删除 30

![[b_tree_del5.svg]]

### 1.2.2 要删除的键在内部节点中

![[b_tree_del6.svg]]

- 后继 key 替换掉待删除的 key 后，在叶子结点中删除 key
	- 35 替代 33，删除 33
- 删除后，按删除叶子节点的情况进行调整
	- 32 上移，35 下移

![[b_tree_del7.svg]]

# 2.B+Tree
## 2.1 B+树的性质
- $m$ 阶 B+树满足
	- 每个节点最多有 $m$ 个子节点
	- 每个非叶子节点至少有 $ceil(\frac{m}{2})$ 个 `key`
	- 子结点个数与 key 的个数相同
	- 叶子节点存有相邻叶子节点的指针，由小到大顺序连接
	- 内部节点只保存索引，不保存数据，数据全部在叶子节点中
## 2.2 B+树的插入
