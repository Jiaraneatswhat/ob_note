# 1. 使用到的小框架
## 1.1 DataX
### 1.1.1 原理
### 1.1.2 做过哪些优化
#### 1.1.2.1 全局
- 提升每个 `Channel` 的速度
	- `DataX` 内部限制
		- 每秒同步的 `record` 的个数
		- 每秒同步的字节数
- 可以将单个 `Channel` 的速度上限增加到 `5MB/s`
```Python
{
"speed":{
	"channel": 2,  # 此处为数据导入的并发度，建议根据服务器硬件进行调优
	"record": -1, # 此处解除对读取行数的限制
	"byte": 5242880, # 此处解除对字节的限制
	"batchSize": 204 # 每次读取batch的大小
	}
}
```
#### 1.1.2.2 局部
- 提升 `Job` 内 `Channel` 的并发数
	- 配置全局 `Byte` 限速以及单` Channel Byte` 限速
		- `Channel 数 = 全局 Byte 限速 / 单 Channel Byte 限速`
	- 配置全局 `Record` 限速以及单 ` Channel Byte` 限速
		- `Channel 数 = 全局 Record 限速 / 单 Channel Byte 限速`
	- 直接配置 `Channel` 个数
#### 1.1.2.3 内存
- 执行 `datax.py` 时直接加参数
	- `python datax/bin/datax.py --jvm="-Xms8G -Xmx8G" /path/to/your/job.json`
### 1.1.3 遇到过什么问题
- Null 值问题
	- MySQL 中的 `null` 值就是 `null`，而 `Hive` 中的 `null` 值用'\\N'来存储
	- MySQL -> Hive
		- 建表时手动指定 `null` 值
		- `null defined as ''`
	- Hive -> MySQL
		- 在 DataX 的 hdfsreader 中指定属性
		- `"parameter":{"nullFormat: ""}`
### 1.1.4 与 Sqoop 的比较
- Sqoop 的原理：
	- 仅 `Mapper` 任务的 `MR`
	- 自定义了 `InputFormat` 和 `OutputFormat`
- `DataX` 是一个多进程的线程
- `Sqoop` 支持分布式，`DataX` 可以通过调度系统实现
- `DataX` 有流控功能
- `DataX` 有统计信息和数据校验
### 1.1.5 DataX 为什么不使用增量同步
- DataX 的增量同步是新版本才有的功能，以前搭好的采集系统没有更改

## 1.2 DolphinScheduler
### 1.2.1 DS 挂了怎么办
- 查看日志报错原因
- 一般是资源不够导致，增加资源后重启
### 1.2.2 调度的任务挂了怎么办
- 配置告警及时处理
- 查看日志解决问题
- 重新跑任务
### 1.2.3 什么时候开始调度
- 需要调度的属于全量同步
- 业务数据：每天的 00: 00开始 ---->  `DataX` 全量同步
- 日志数据：每天的 00：30 开始 ----> `Load` 命令将数据加载到 `ODS` 层
	- 在 Flume 中的 HDFS Sink 中设置的滚动文件的周期是 30min
	- 需要等待 30min 防止没有滚动结束
# 2. 每天的指标有多少
- 100 个指标，节假日、活动时有大概 150-200 个
- 从用户来说
	- 统计用户的变动情况，回流，流式等
	- 统计用户留存率
	- 统计 1/7/30 日用户的新增和活跃情况
	- 用户的行为漏斗分析
- 从商品来说
	- 统计最近 30 日的复购率
	- 统计 1/7/30 日各品牌下单情况
	-  统计 1/7/30 日各品类下单情况
- 从交易相关来说
	- 统计下单到支付的平均时间间隔
	- 各省份的交易统计
- 从用户的行为日志中
	- 统计各渠道的流量
	- 路径分析
# 3. 建模准备
## 3.1 模型
- ER 模型
	- 三范式
		- 第一范式：属性不可分割，保证了数据的可用性
		- 第二范式：非主键字段完全依赖主键，不能存在部分函数依赖，减少了数据冗余
		- 第三范式：非主键字段不能传递依赖于主键，不能存在传递函数依赖，保证了数据的一致性
- 维度模型
- 星型模型：事实表只有一级维度

![[star_schema.svg]]

- 雪花模型：事实表存在多级维度

![[snowflake_schema.svg]]

- 星座模型: 多张事实表存在相同的维度表

- 事实表
	- 概念
		- 由用户行为产生的业务过程数据
	- 导入方式
		- `maxwell` 增量
		- 特殊：加购表为存量型指标，使用全量和增量
	- 种类
		- 事务型事实表
			- 选择业务过程 -> 声明粒度 -> 确定维度 -> 确定事实
			- 缺点：
				- 存量型指标
				- 多事实关联: 需要多张表 `join`
		- 周期型快照事实表
		- 累积型快照事实表