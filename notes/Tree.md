# 1. B-Tree
- 2-3 树是一种特殊的 B-树，它满足：
	- 2-节点有 {0, 2} 个子节点
	- 3-节点有 {0, 3} 个子节点
	- 所有叶子节点都在同一层
## 1.1 B-树的性质

- B 树非叶子节点的结构

![[b_tree_node.svg]]
- $n$: key 的个数
- $p$：指针
- $k$：key
- $p_0$ 至 $p_n$ 从小到大排列用于划分区间
- $k$ 的个数比 $p$ 的个数少一个

- $m$ 阶 B -树的性质
	- 每个节点最多有 $m$ 个子节点，至多含有 $m-1$ 个`key`
	- 除根节点外，每个非叶子节点至少有 $ceil(\frac{m}{2})$ 个子节点
	- 根节点有 0 或者至少 2 个子节点
	- 叶子节点都在同一层
- B-树将文件以 <font color='red'>Page</font> 为单位进行存储，每个 Page 作为 B-树的一个节点

![[b_tree_page.svg]]

B-树每个节点都存放着索引和数据，搜索可能在非叶子节点结束，最好的情况是 $O(1)$
## 1.2 B-树的删除
### 1.2.1 要删除的键在叶子节点中
#### 1.2.1.1 不超过子结点 key 下限

![[b_tree_del1.svg]]

- 此时删除 31 没有影响(3 阶要求非叶子节点且非根节点有 $ceil(3/2)=2$ 个结点)，直接删除
#### 1.2.1.2 超过子结点 key 下限

![[b_tree_del2.svg]]

- 此时不能直接删除 32
- 对树结构做调整：从左至右向兄弟节点借用 `key`，借到 28
	- 28 上移，30 下移后删除 32

![[b_tree_del3.svg]]

#### 1.2.1.3 可以合并的情况

![[b_tree_del4.svg]]

- 要删除 30 时，左右兄弟节点都不能借节点时，需要进行合并
	- 28 下移与 25 合并后删除 30

![[b_tree_del5.svg]]

### 1.2.2 要删除的键在内部节点中

![[b_tree_del6.svg]]

- 后继 key 替换掉待删除的 key 后，在叶子结点中删除 key
	- 35 替代 33，删除 33
- 删除后，按删除叶子节点的情况进行调整
	- 32 上移，35 下移

![[b_tree_del7.svg]]

# 2.B+Tree
## 2.1 B+树的性质
- $m$ 阶 B+树满足
	- 每个节点最多有 $m$ 个子节点
	- 每个非叶子节点至少有 $ceil(\frac{m}{2})$ 个 `key`
	- 子结点个数与 key 的个数相同
	- 叶子节点存有相邻叶子节点的指针，由小到大顺序连接
	- 内部节点只保存索引，不保存数据，数据全部在叶子节点中
## 2.2 B+树的插入

- 不超过 4 个节点时直接插入

![[b+insert1.svg]]

- 后续再插入时需要分裂

![[b+insert2.svg]]

- 前 $ceil(\frac{m}{2})=2$ 个记录放在左子节点，剩下的放在右子节点，第 $ceil(\frac{m}{2})+1$ 个记录的 `key` 进位至父节点(索引节点)，与之类似，当索引节点达到 5 个，需要进行分裂时，进位后的索引节点在子节点中不会保留

![[b+insert3.svg]]

## 2.3 B+树的删除

![[b+del1.svg]]

- 要删除的 `key` 是索引节点的 `key`，向兄弟节点借 `key` 后替换索引节点并删除

![[b+del2.svg]]

- 要删除的 `key` 是索引节点的 `key`，向兄弟节点借不到 `key` 时
- 合并后删除父节点中的 `key`
- B+树删除后索引节点中的 `key` 在叶子节点中不一定存在对应的记录
# 3. 红黑树
## 3.1 红黑树的规则
- 根节点为黑色
- 每个叶子节点都是黑色的空节点(Nil)
- 从根节点到叶子节点不会出现连续的红色节点
- 从任意一个节点出发到其子节点的所有路径都包含相同个数的黑色节点
## 3.2 2-3-4 树节点和红黑树的对应关系

![[rbtree_to_234_tree.svg]]
## 3.3 红黑树的插入
### 3.3.1 第一次插入为根节点，染黑
### 3.3.2 第二次插入的为红色节点

![[rbtree_insert1.svg]]

### 3.3.3 插入 3 个节点时，有 4 种需要调整的情况

![[rbtree_insert2.svg]]
- 针对(3)(4)的情况，父节点进行旋转得到(1)(2)
- 之后祖父节点再进行旋转，变色

![[rbtree_insert3.svg]]

### 3.3.4 插入第 4个节点时，需要变色

